<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Pixel Cleaner Game</title>
    <style>
        canvas { border: 1px solid black; }
        body { text-align: center; font-family: Arial; }
    </style>
</head>
<body>
    <h1>Очисти все пиксели!</h1>
    <p id="status">Очищено: 0/2500 (0.0%) | Время: 03:00</p>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <br>
    <button onclick="resetGame()">Перезапустить</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gridSize = 50;
        const pixelSize = 8;
        const totalPixels = gridSize * gridSize;
        let clearedPixels = 0;
        let timeLeft = 180; // 3 минуты
        let timerInterval;
        let grid = Array(gridSize).fill().map(() => Array(gridSize).fill(0)); // 0 - чёрный, 1 - белый

        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    ctx.fillStyle = grid[y][x] === 1 ? 'white' : 'black';
                    ctx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
                }
            }
        }

        function updateStatus() {
            const percentage = (clearedPixels / totalPixels * 100).toFixed(1);
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('status').textContent = `Очищено: ${clearedPixels}/${totalPixels} (${percentage}%) | Время: ${timeStr}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateStatus();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if (clearedPixels < totalPixels) {
                        showCrack();
                        document.getElementById('status').textContent = 'Game Over! Время вышло, и экран треснул.';
                    } else {
                        document.getElementById('status').textContent = 'Победа! Все пиксели очищены!';
                    }
                }
            }, 1000);
        }

        function showCrack() {
            ctx.strokeStyle = 'gray';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(100, 100);
            ctx.lineTo(200, 200);
            ctx.lineTo(300, 150);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(50, 300);
            ctx.lineTo(150, 250);
            ctx.lineTo(250, 350);
            ctx.stroke();
        }

        canvas.addEventListener('click', (e) => {
            if (timeLeft <= 0) return;
            const rect = canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / pixelSize);
            const y = Math.floor((e.clientY - rect.top) / pixelSize);
            if (x >= 0 && x < gridSize && y >= 0 && y < gridSize && grid[y][x] === 0) {
                grid[y][x] = 1;
                clearedPixels++;
                drawGrid();
                updateStatus();
                if (clearedPixels === totalPixels) {
                    clearInterval(timerInterval);
                    document.getElementById('status').textContent = 'Победа! Все пиксели очищены!';
                }
            }
        });

        function resetGame() {
            grid = Array(gridSize).fill().map(() => Array(gridSize).fill(0));
            clearedPixels = 0;
            timeLeft = 180;
            drawGrid();
            updateStatus();
            clearInterval(timerInterval);
            startTimer();
        }

        // Инициализация
        drawGrid();
        updateStatus();
        startTimer();
    </script>
</body>
</html>